<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ğŸ“„vue-lazyload(æ‡’åŠ è½½ï¼‰ | Loloya</title>
    <meta name="description" content="äººç”Ÿè‹¦çŸ­,ä½œæ­»å¯»æ¬¢ âœ¨">
    <link rel="icon" href="/img/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.cfcf5ab8.css" as="style"><link rel="preload" href="/assets/js/app.d3efc14e.js" as="script"><link rel="preload" href="/assets/js/2.3a3a5c3a.js" as="script"><link rel="preload" href="/assets/js/26.e8884916.js" as="script"><link rel="prefetch" href="/assets/js/10.a9daca65.js"><link rel="prefetch" href="/assets/js/11.da12bc9d.js"><link rel="prefetch" href="/assets/js/12.4618ee3d.js"><link rel="prefetch" href="/assets/js/13.ef30e496.js"><link rel="prefetch" href="/assets/js/14.11123a73.js"><link rel="prefetch" href="/assets/js/15.2a8791de.js"><link rel="prefetch" href="/assets/js/16.501f4c9d.js"><link rel="prefetch" href="/assets/js/17.7c687ef5.js"><link rel="prefetch" href="/assets/js/18.2d093817.js"><link rel="prefetch" href="/assets/js/19.8760919d.js"><link rel="prefetch" href="/assets/js/20.02192eef.js"><link rel="prefetch" href="/assets/js/21.64349d94.js"><link rel="prefetch" href="/assets/js/22.d9c5ce44.js"><link rel="prefetch" href="/assets/js/23.2465dc59.js"><link rel="prefetch" href="/assets/js/24.7ee60829.js"><link rel="prefetch" href="/assets/js/25.ec0d75d8.js"><link rel="prefetch" href="/assets/js/27.17bc2875.js"><link rel="prefetch" href="/assets/js/3.b1dc7b00.js"><link rel="prefetch" href="/assets/js/4.b75841e9.js"><link rel="prefetch" href="/assets/js/5.71e06a64.js"><link rel="prefetch" href="/assets/js/6.a90ce58d.js"><link rel="prefetch" href="/assets/js/7.93734918.js"><link rel="prefetch" href="/assets/js/8.aefe1e94.js"><link rel="prefetch" href="/assets/js/9.3f7cb3a9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cfcf5ab8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Loloya</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/pages/BBS.html" class="sidebar-link">ğŸ‘»</a></li><li><a href="/pages/about.html" class="sidebar-link">è¿™ä¸ªåšå®¢çš„è¯ç”Ÿ</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML + CSSåŸºç¡€</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JSåŸºç¡€(ES5)</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JSåŸºç¡€(ES6+)</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Vue</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/vue/_brief.html" class="sidebar-link">ğŸ“„vueé¡¹ç›®æ­å»º</a></li><li><a href="/pages/vue/vue-cli.html" class="sidebar-link">ğŸ“„vue-cli(ç®€ï¼‰</a></li><li><a href="/pages/vue/vue-lazyload.html" class="active sidebar-link">ğŸ“„vue-lazyload(æ‡’åŠ è½½ï¼‰</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/vue/vue-lazyload.html#æ‡’åŠ è½½" class="sidebar-link">æ‡’åŠ è½½</a></li><li class="sidebar-sub-header"><a href="/pages/vue/vue-lazyload.html#ä¸ºä»€ä¹ˆéœ€è¦æ‡’åŠ è½½ï¼Ÿ" class="sidebar-link">ä¸ºä»€ä¹ˆéœ€è¦æ‡’åŠ è½½ï¼Ÿ</a></li><li class="sidebar-sub-header"><a href="/pages/vue/vue-lazyload.html#å›¾ç‰‡æ‡’åŠ è½½" class="sidebar-link">å›¾ç‰‡æ‡’åŠ è½½</a></li><li class="sidebar-sub-header"><a href="/pages/vue/vue-lazyload.html#ç»„ä»¶æ‡’åŠ è½½" class="sidebar-link">ç»„ä»¶æ‡’åŠ è½½</a></li></ul></li><li><a href="/pages/vue/patch.html" class="sidebar-link">ğŸ“„é‡åˆ°çš„é—®é¢˜</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>RegExp</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>åšå®¢ç›¸å…³</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Lunix</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>PHP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>NODE</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å…¶ä»–</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ğŸ“„vue-lazyload-æ‡’åŠ è½½ï¼‰"><a href="#ğŸ“„vue-lazyload-æ‡’åŠ è½½ï¼‰" aria-hidden="true" class="header-anchor">#</a> ğŸ“„vue-lazyload(æ‡’åŠ è½½ï¼‰</h1> <h2 id="æ‡’åŠ è½½"><a href="#æ‡’åŠ è½½" aria-hidden="true" class="header-anchor">#</a> æ‡’åŠ è½½</h2> <ul><li>ä¹Ÿå«å»¶è¿ŸåŠ è½½ï¼Œ å³åœ¨éœ€è¦çš„æ—¶å€™è¿›è¡ŒåŠ è½½ï¼Œ éšç”¨éšè½½ã€‚</li> <li>ä¸ªäººæ ¹æ®åŠŸèƒ½åˆ’åˆ†ä¸ºå›¾ç‰‡çš„æ‡’åŠ è½½å’Œç»„ä»¶çš„æ‡’åŠ è½½ã€‚</li></ul> <h2 id="ä¸ºä»€ä¹ˆéœ€è¦æ‡’åŠ è½½ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦æ‡’åŠ è½½ï¼Ÿ" aria-hidden="true" class="header-anchor">#</a> ä¸ºä»€ä¹ˆéœ€è¦æ‡’åŠ è½½ï¼Ÿ</h2> <p>åƒvueè¿™ç§å•é¡µé¢åº”ç”¨ï¼Œ å¦‚æœæ²¡æœ‰åº”ç”¨æ‡’åŠ è½½ï¼Œ è¿ç”¨webpackæ‰“åŒ…åçš„æ–‡ä»¶å°†ä¼šå¼‚å¸¸çš„å¤§ï¼Œ é€ æˆè¿›å…¥é¦–é¡µæ—¶ï¼Œ éœ€è¦åŠ è½½çš„å†…å®¹è¿‡å¤šï¼Œ æ—¶é—´è¿‡é•¿ï¼Œ ä¼šå‡ºå•Šå…ˆé•¿æ—¶é—´çš„ç™½å±ï¼Œ å³ä½¿åšäº†loadingä¹Ÿæ˜¯ä¸åˆ©äºç”¨æˆ·ä½“éªŒï¼Œ è€Œè¿ç”¨æ‡’åŠ è½½åˆ™å¯ä»¥å°†é¡µé¢è¿›è¡Œåˆ’åˆ†ï¼Œ éœ€è¦çš„æ—¶å€™åŠ è½½é¡µé¢ï¼Œ å¯ä»¥æœ‰æ•ˆçš„åˆ†æ‹…é¦–é¡µæ‰€æ‰¿æ‹…çš„åŠ è½½å‹åŠ›ï¼Œ å‡å°‘é¦–é¡µåŠ è½½ç”¨æ—¶ã€‚</p> <p>ç®€å•çš„è¯´å°±æ˜¯ï¼š è¿›å…¥é¦–é¡µä¸ç”¨ä¸€æ¬¡åŠ è½½è¿‡å¤šèµ„æºï¼Œ é€ æˆç”¨æ—¶è¿‡é•¿ã€‚</p> <h2 id="å›¾ç‰‡æ‡’åŠ è½½"><a href="#å›¾ç‰‡æ‡’åŠ è½½" aria-hidden="true" class="header-anchor">#</a> å›¾ç‰‡æ‡’åŠ è½½</h2> <h4 id="ä½¿ç”¨vue-lazyloadæ’ä»¶ï¼š"><a href="#ä½¿ç”¨vue-lazyloadæ’ä»¶ï¼š" aria-hidden="true" class="header-anchor">#</a> ä½¿ç”¨vue-lazyloadæ’ä»¶ï¼š</h4> <ol><li>ä¸‹è½½</li></ol> <p><code>$ npm install vue-lazyload -D</code></p> <ol start="2"><li>æ³¨å†Œæ’ä»¶</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>   <span class="token comment">// main.js:</span>

   <span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
   <span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span>
   <span class="token keyword">import</span> VueLazyload <span class="token keyword">from</span> <span class="token string">'vue-lazyload'</span>
   <span class="token comment">// ä½¿ç”¨æ–¹æ³•1:</span>
   Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueLazyload<span class="token punctuation">)</span>

   <span class="token comment">// ä½¿ç”¨æ–¹æ³•2: è‡ªå®šä¹‰å‚æ•°é€‰é¡¹é…ç½®</span>
   Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueLazyload<span class="token punctuation">,</span> <span class="token punctuation">{</span>
       preLoad<span class="token punctuation">:</span> <span class="token number">1.3</span><span class="token punctuation">,</span> <span class="token comment">// æå‰åŠ è½½é«˜åº¦ï¼ˆæ•°å­— 1 è¡¨ç¤º 1 å±çš„é«˜åº¦ï¼‰ é»˜è®¤å€¼ï¼š 1.3</span>
       error<span class="token punctuation">:</span> <span class="token string">'dist/error.png'</span><span class="token punctuation">,</span> <span class="token comment">// å½“åŠ è½½å›¾ç‰‡å¤±è´¥çš„æ—¶å€™</span>
       loading<span class="token punctuation">:</span> <span class="token string">'dist/loading.gif'</span><span class="token punctuation">,</span> <span class="token comment">// å›¾ç‰‡åŠ è½½çŠ¶æ€ä¸‹æ˜¾ç¤ºçš„å›¾ç‰‡</span>
       attempt<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token comment">//	åŠ è½½é”™è¯¯åæœ€å¤§å°è¯•æ¬¡æ•° é»˜è®¤å€¼ï¼š 3</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol start="3"><li>åœ¨é¡µé¢ä¸­ä½¿ç”¨</li></ol> <div class="language-html extra-class"><pre class="language-html"><code>   <span class="token comment">&lt;!-- mobile.vue --&gt;</span>
   
   <span class="token comment">&lt;!-- ä½¿ç”¨æ–¹æ³•1: å¯èƒ½å›¾ç‰‡urlæ˜¯ç›´æ¥ä»åå°æ‹¿åˆ°çš„ï¼Œ æŠŠâ€˜:src'æ›¿æ¢æˆâ€˜v-lazy'å°±è¡Œ --&gt;</span> 
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>img in list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">v-lazy</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>img.src<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
   
   <span class="token comment">&lt;!-- ä½¿ç”¨æ–¹æ³•2: ä½¿ç”¨æ‡’åŠ è½½å®¹å™¨v-lazy-container, å’Œv-lazyå·®ä¸å¤šï¼Œ é€šè¿‡è‡ªå®šä¹‰æŒ‡ä»¤å»å®šä¹‰çš„ï¼Œ ä¸è¿‡v-lazy-containeræ‰«æçš„æ˜¯å†…éƒ¨çš„å­å…ƒç´  --&gt;</span> 
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-lazy-container</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{ selector: 'img'}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/static/mobile/bohai/p2/bg.jpg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/static/mobile/bohai/p3/bg.jpg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
       ...
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/static/mobile/bohai/p13/bg.jpg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
   
   
</code></pre></div><blockquote><p>æ³¨æ„ï¼š v-lazy='src'ä¸­çš„srcä¸€å®šè¦ä½¿ç”¨dataé‡Œé¢çš„å˜é‡ï¼Œ ä¸èƒ½å†™çœŸå®çš„å›¾ç‰‡è·¯å¾„ï¼Œ è¿™æ ·ä¼šæŠ¥é”™å¯¼è‡´æ²¡æœ‰æ•ˆæœï¼Œ å› ä¸ºvueçš„è‡ªå®šä¹‰æŒ‡ä»¤å¿…é¡»å¯¹åº”dataä¸­çš„å˜é‡ åªèƒ½æ˜¯å˜é‡ï¼› v-lazy-containerå†…éƒ¨æŒ‡å®šå…ƒç´ è®¾ç½®çš„data-srcæ˜¯å›¾ç‰‡çš„çœŸå®è·¯å¾„ï¼Œ ä¸èƒ½æ˜¯dataå˜é‡ï¼Œ è¿™ä¸ªå’Œv-lazyå®Œå…¨ç›¸åã€‚</p></blockquote> <ol start="4"><li>ç»™æ¯ä¸€ä¸ªçŠ¶æ€æ·»åŠ æ ·å¼</li></ol> <div class="language-css extra-class"><pre class="language-css"><code>   <span class="token selector">&lt;style&gt;
     img[lazy=loading]</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
     <span class="token selector">img[lazy=error]</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
     <span class="token selector">img[lazy=loaded]</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
   &lt;/style&gt;
</code></pre></div><h2 id="ç»„ä»¶æ‡’åŠ è½½"><a href="#ç»„ä»¶æ‡’åŠ è½½" aria-hidden="true" class="header-anchor">#</a> ç»„ä»¶æ‡’åŠ è½½</h2> <blockquote><p>ä¸»è¦åˆ†ä»¥ä¸‹å‡ æ­¥ï¼š</p></blockquote> <blockquote><ol><li>å…¼å®¹ä½ç‰ˆæœ¬æµè§ˆå™¨ =&gt; 2. æ–°å»ºæ‡’åŠ è½½ç»„ä»¶ =&gt; 3. æ–°å»ºå…¬å…±éª¨æ¶å±ç»„ä»¶ =&gt; 4. å¼‚æ­¥åŠ è½½å­ç»„ä»¶ =&gt; 5. é¡µé¢ä¸­ä½¿ç”¨</li></ol></blockquote> <h4 id="_1-å…¼å®¹ä½ç‰ˆæœ¬æµè§ˆå™¨"><a href="#_1-å…¼å®¹ä½ç‰ˆæœ¬æµè§ˆå™¨" aria-hidden="true" class="header-anchor">#</a> 1. å…¼å®¹ä½ç‰ˆæœ¬æµè§ˆå™¨</h4> <ol><li><p>è¯¥é¡¹ç›®ä¾èµ– <a href="https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API" target="_blank" rel="noopener noreferrer">IntersectionObserver API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼Œ å¦‚éœ€åœ¨è¾ƒä½ç‰ˆæœ¬æµè§ˆå™¨è¿è¡Œï¼Œ éœ€è¦é¦–å…ˆå¤„ç†å…¼å®¹ä½ç‰ˆæœ¬æµè§ˆå™¨ï¼Œ éœ€è¦å¼•å…¥æ’ä»¶ <strong>IntersectionObserver API polyfill</strong></p></li> <li><p>ä½¿ç”¨</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code>   <span class="token comment">// 1. ä¸‹è½½</span>
   $ npm install intersection <span class="token operator">-</span> observer <span class="token operator">-</span> <span class="token constant">D</span>

   <span class="token comment">// 2. åœ¨mian.jså¼•å…¥</span>
   <span class="token keyword">import</span> <span class="token string">'intersection-observer'</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_2-æ–°å»ºä¸€ä¸ªvuelazycomponent-vue-æ–‡ä»¶"><a href="#_2-æ–°å»ºä¸€ä¸ªvuelazycomponent-vue-æ–‡ä»¶" aria-hidden="true" class="header-anchor">#</a> 2. æ–°å»ºä¸€ä¸ªVueLazyComponent.vue æ–‡ä»¶</h4> <blockquote><p>å› ä¸ºä½¿ç”¨çš„æ‡’åŠ è½½ç»„ä»¶æ’ä»¶éƒ¨åˆ†ä¸æ»¡è¶³æˆ‘ä»¬å®˜ç½‘é¡¹ç›®ï¼Œ æ‰€ä»¥æŠŠvue-lazy-componentæ’ä»¶çš„æ ¸å¿ƒä»£ç å–å‡ºæ¥ï¼Œ æ–°å»ºä¸€ä¸ªVueLazyComponent.vueæ–‡ä»¶å­˜æ”¾ï¼Œ åœ¨é¡¹ç›®ä¸­éœ€è¦ä½¿ç”¨åˆ°æ‡’åŠ è½½ç»„ä»¶çš„é¡µé¢å¼•å…¥å³å¯ã€‚</p></blockquote> <ol><li><p>åœ¨éœ€è¦ä½¿ç”¨æ‡’åŠ è½½çš„é¡µé¢å¼•å…¥ VueLazyComponent.vue æ–‡ä»¶</p> <ul><li>å¼•å…¥</li></ul></li></ol> <div class="language-vue extra-class"><pre class="language-vue"><code>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
     <span class="token comment">// å¼•å…¥å­˜æ”¾åœ¨mobileå…¬å…±æ–‡ä»¶å¤¹é‡Œçš„VueLazyComponent.vue æ¥åŒ…è£¹éœ€è¦åŠ è½½çš„å­ç»„ä»¶</span>
     <span class="token keyword">import</span> VueLazyComponent <span class="token keyword">from</span> <span class="token string">'components/mobile/common/VueLazyComponent'</span><span class="token punctuation">;</span> 
     <span class="token comment">// å¼•å…¥éª¨æ¶å±ç»„ä»¶ (è¯¦ç»†è§-éª¨æ¶å±ç»„ä»¶ï¼‰ åœ¨å­ç»„ä»¶æœªåŠ è½½æ—¶ï¼Œ ä¸ºå¾…åŠ è½½çš„å­ç»„ä»¶å…ˆå æ®ä¸€å—ç©ºé—´</span>
     <span class="token keyword">import</span> MobileSkeleton <span class="token keyword">from</span> <span class="token string">'components/mobile/common/MobileSkeleton'</span><span class="token punctuation">;</span> 
   
     <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
       components<span class="token punctuation">:</span> <span class="token punctuation">{</span>
         <span class="token string">'vue-lazy-component'</span><span class="token punctuation">:</span> VueLazyComponent<span class="token punctuation">,</span> 
         <span class="token string">'mobile-skeleton'</span><span class="token punctuation">:</span> MobileSkeleton<span class="token punctuation">,</span> 
       <span class="token punctuation">}</span><span class="token punctuation">,</span> 
     <span class="token punctuation">}</span><span class="token punctuation">;</span> 
   </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ol start="2"><li><p>VueLazyComponent.vue æºç è§£è¯»</p> <ul><li><p>ä½¿ç”¨åˆ°çš„å‚æ•°å’Œäº‹ä»¶</p> <p>** Props **</p></li></ul></li></ol> <table><thead><tr><th>å‚æ•°</th> <th>è¯´æ˜</th> <th>ç±»å‹</th> <th>å¯é€‰å€¼</th> <th>é»˜è®¤å€¼</th></tr></thead> <tbody><tr><td>viewport</td> <td>ç»„ä»¶æ‰€åœ¨çš„è§†å£ï¼Œ å¦‚æœç»„ä»¶æ˜¯åœ¨é¡µé¢å®¹å™¨å†…æ»šåŠ¨ï¼Œ è§†å£å°±æ˜¯è¯¥å®¹å™¨</td> <td>HTMLElement</td> <td>true</td> <td><code>null</code> ï¼Œ ä»£è¡¨è§†çª—</td></tr> <tr><td>direction</td> <td>è§†å£çš„æ»šåŠ¨æ–¹å‘ï¼Œ <code>vertical</code> ä»£è¡¨å‚ç›´æ–¹å‘ï¼Œ <code>horizontal</code> ä»£è¡¨æ°´å¹³æ–¹å‘</td> <td>String</td> <td>true</td> <td><code>vertical</code></td></tr> <tr><td>threshold</td> <td>é¢„åŠ è½½é˜ˆå€¼ï¼Œ csså•ä½</td> <td>String</td> <td>true</td> <td><code>0px</code></td></tr> <tr><td>tagName</td> <td>åŒ…è£¹ç»„ä»¶çš„å¤–å±‚å®¹å™¨çš„æ ‡ç­¾å</td> <td>String</td> <td>true</td> <td><code>div</code></td></tr> <tr><td>timeout</td> <td>ç­‰å¾…æ—¶é—´ï¼Œ å¦‚æœæŒ‡å®šäº†æ—¶é—´ï¼Œ ä¸è®ºå¯è§ä¸å¦ï¼Œ åœ¨æŒ‡å®šæ—¶é—´ä¹‹åè‡ªåŠ¨åŠ è½½</td> <td>Number</td> <td>true</td> <td>-</td></tr></tbody></table> <pre><code>  ** Events **
</code></pre> <table><thead><tr><th>äº‹ä»¶å</th> <th>è¯´æ˜</th> <th>äº‹ä»¶å‚æ•°</th></tr></thead> <tbody><tr><td>before-init</td> <td>æ¨¡å—å¯è§æˆ–å»¶æ—¶æˆªæ­¢å¯¼è‡´å‡†å¤‡å¼€å§‹åŠ è½½æ‡’åŠ è½½æ¨¡å—</td> <td>-</td></tr> <tr><td>init</td> <td>å¼€å§‹åŠ è½½æ‡’åŠ è½½æ¨¡å—ï¼Œ æ­¤æ—¶éª¨æ¶ç»„ä»¶å¼€å§‹æ¶ˆå¤±</td> <td>-</td></tr> <tr><td>before-enter</td> <td>æ‡’åŠ è½½æ¨¡å—å¼€å§‹è¿›å…¥</td> <td>el</td></tr> <tr><td>before-leave</td> <td>éª¨æ¶ç»„ä»¶å¼€å§‹ç¦»å¼€</td> <td>el</td></tr> <tr><td>after-leave</td> <td>éª¨æ¶ç»„ä»¶å·²ç»ç¦»å¼€</td> <td>el</td></tr> <tr><td>after-enter</td> <td>æ‡’åŠ è½½æ¨¡å¿«å·²ç»è¿›å…¥</td> <td>el</td></tr> <tr><td>after-init</td> <td>åˆå§‹åŒ–å®Œæˆ</td> <td></td></tr></tbody></table> <div class="language-vue extra-class"><pre class="language-vue"><code>   <span class="token comment">&lt;!-- VueLazyComponent.vue --&gt;</span>
   
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition-group</span> <span class="token attr-name">:tag</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>tagName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>lazy-component<span class="token punctuation">&quot;</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span> </span><span class="token punctuation">&quot;</span></span>
                       <span class="token attr-name">@before-enter</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(el) =&gt; $emit('before-enter', el)<span class="token punctuation">&quot;</span></span>
                       <span class="token attr-name">@before-leave</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(el) =&gt; $emit('before-leave', el)<span class="token punctuation">&quot;</span></span>
                       <span class="token attr-name">@after-enter</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(el) =&gt; $emit('after-enter', el)<span class="token punctuation">&quot;</span></span>
                       <span class="token attr-name">@after-leave</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(el) =&gt; $emit('after-leave', el)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>isInit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>component<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">:loading</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>loading<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>$slots.skeleton<span class="token punctuation">&quot;</span></span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>skeleton<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>skeleton<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-else</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>loading<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition-group</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
   
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
   <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
     name<span class="token punctuation">:</span> <span class="token string">'VueLazyComponent'</span><span class="token punctuation">,</span> 
   
     props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
       timeout<span class="token punctuation">:</span> <span class="token punctuation">{</span>
         type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span> 
         <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token number">0</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span> 
       tagName<span class="token punctuation">:</span> <span class="token punctuation">{</span>
         type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> 
         <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">'div'</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span> 
       viewport<span class="token punctuation">:</span> <span class="token punctuation">{</span>
         type<span class="token punctuation">:</span> <span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">?</span> window<span class="token punctuation">.</span> HTMLElement <span class="token punctuation">:</span> Object<span class="token punctuation">,</span> 
         <span class="token function-variable function">default</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">null</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span> 
       threshold<span class="token punctuation">:</span> <span class="token punctuation">{</span>
         type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> 
         <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">'0px'</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span> 
       direction<span class="token punctuation">:</span> <span class="token punctuation">{</span>
         type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> 
         <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">'vertical'</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span> 
       maxWaitingTime<span class="token punctuation">:</span> <span class="token punctuation">{</span>
         type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span> 
         <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token number">50</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span> 
   
     <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token punctuation">{</span>
         isInit<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> 
         timer<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> 
         io<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> 
         loading<span class="token punctuation">:</span> <span class="token boolean">false</span>
       <span class="token punctuation">}</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span><span class="token punctuation">,</span> 
   
     <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">// å¦‚æœæŒ‡å®štimeoutåˆ™æ— è®ºå¯è§ä¸å¦éƒ½æ˜¯åœ¨timeoutä¹‹ååˆå§‹åŒ–</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
           <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
         <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span> 
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span> 
   
     <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token comment">// æ ¹æ®æ»šåŠ¨æ–¹å‘æ¥æ„é€ è§†å£å¤–è¾¹è·ï¼Œ ç”¨äºæå‰åŠ è½½</span>
         <span class="token keyword">let</span> rootMargin<span class="token punctuation">;</span> 
         <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>direction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">case</span> <span class="token string">'vertical'</span><span class="token punctuation">:</span>
             rootMargin <span class="token operator">=</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>threshold<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 0px`</span></span> <span class="token punctuation">;</span> 
             <span class="token keyword">break</span><span class="token punctuation">;</span> 
           <span class="token keyword">case</span> <span class="token string">'horizontal'</span><span class="token punctuation">:</span>
             rootMargin <span class="token operator">=</span> <span class="token template-string"><span class="token string">`0px </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>threshold<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span> <span class="token punctuation">;</span> 
             <span class="token keyword">break</span><span class="token punctuation">;</span> 
           <span class="token keyword">default</span><span class="token punctuation">:</span>
           <span class="token comment">// do nothing</span>
         <span class="token punctuation">}</span>
   
         <span class="token comment">// è§‚å¯Ÿè§†å£ä¸ç»„ä»¶å®¹å™¨çš„äº¤å‰æƒ…å†µ</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span>io <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">window<span class="token punctuation">.</span></span> <span class="token function">IntersectionObserver</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>intersectionHandler<span class="token punctuation">,</span> <span class="token punctuation">{</span>
           rootMargin<span class="token punctuation">,</span> 
           root<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>viewport<span class="token punctuation">,</span> 
           threshold<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> Number<span class="token punctuation">.</span> <span class="token constant">MIN_VALUE</span><span class="token punctuation">,</span> <span class="token number">0.01</span><span class="token punctuation">]</span>
         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
         <span class="token keyword">this</span><span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">;</span> 
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span> 
   
     <span class="token function">beforeDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">// åœ¨ç»„ä»¶é”€æ¯å‰å–æ¶ˆè§‚å¯Ÿ</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>io<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token function">unobserve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">;</span> 
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span> 
   
     methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
       <span class="token comment">// äº¤å‰æƒ…å†µå˜åŒ–å¤„ç†å‡½æ•°</span>
       <span class="token function">intersectionHandler</span><span class="token punctuation">(</span><span class="token parameter">entries</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>
           <span class="token comment">// æ­£åœ¨äº¤å‰</span>
           entries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isIntersecting <span class="token operator">||</span>
           <span class="token comment">// äº¤å‰ç‡å¤§äº0</span>
           entries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>intersectionRatio
         <span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
           <span class="token keyword">this</span><span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token function">unobserve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">;</span> 
         <span class="token punctuation">}</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span> 
   
       <span class="token comment">// å¤„ç†ç»„ä»¶å’Œéª¨æ¶ç»„ä»¶çš„åˆ‡æ¢</span>
       <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token comment">// æ­¤æ—¶è¯´æ˜éª¨æ¶ç»„ä»¶å³å°†è¢«åˆ‡æ¢</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'beforeInit'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
         <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'before-init'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   
         <span class="token comment">// æ­¤æ—¶å¯ä»¥å‡†å¤‡åŠ è½½æ‡’åŠ è½½ç»„ä»¶çš„èµ„æº</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> 
   
         <span class="token comment">// ç”±äºå‡½æ•°ä¼šåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œ åŠ è½½æ‡’åŠ è½½ç»„ä»¶éå¸¸è€—æ—¶ï¼Œ å®¹æ˜“å¡é¡¿</span>
         <span class="token comment">// æ‰€ä»¥åœ¨requestAnimationFrameå›è°ƒä¸­å»¶åæ‰§è¡Œ</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
           <span class="token keyword">this</span><span class="token punctuation">.</span>isInit <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> 
           <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'init'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
       <span class="token punctuation">}</span><span class="token punctuation">,</span> 
   
       <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token comment">// é˜²æ­¢ç­‰å¾…å¤ªä¹…æ²¡æœ‰æ‰§è¡Œå›è°ƒ</span>
         <span class="token comment">// è®¾ç½®æœ€å¤§ç­‰å¾…æ—¶é—´</span>
         <span class="token comment">// setTimeout(() =&gt; {</span>
         <span class="token comment">//   if (this.isInit) return</span>
         <span class="token comment">//   callback()</span>
         <span class="token comment">// }, this.maxWaitingTime)</span>
   
         <span class="token comment">// å…¼å®¹ä¸æ”¯æŒrequestAnimationFrame çš„æµè§ˆå™¨</span>
         <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">callbackto</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>callbackto<span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span> 
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span> 
   </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>####3. æ–°å»ºéª¨æ¶å±ç»„ä»¶</p> <p>â€‹	éª¨æ¶å±ç»„ä»¶å¹¶æ²¡æœ‰å»è·å–è·å–ä¸åŒå­ç»„ä»¶çš„domèŠ‚ç‚¹ç”Ÿæˆï¼Œ åªæ˜¯ä¸ºäº†å’Œå‚è€ƒçš„æ‡’åŠ è½½æ’ä»¶çš„é€»è¾‘ä¿æŒä¸€è‡´ï¼Œ å­ç»„ä»¶æ˜¯å¼‚æ­¥åŠ è½½ï¼Œ æ‰€ä»¥åœ¨å­ç»„ä»¶åŠ è½½å‰ï¼Œ çˆ¶ç»„ä»¶ä¸Šæœ‰ <code>slot=&quot;skeleton&quot;</code> çš„ç»„ä»¶ä¼šå…ˆæ‰§è¡Œï¼Œ ä¸ºå­ç»„ä»¶åœ¨åŠ è½½å‰åœ¨é¡µé¢ä¸Šå æ®ä½ç½®ã€‚</p> <h4 id="_4-å¼‚æ­¥å¼•å…¥ç»„ä»¶"><a href="#_4-å¼‚æ­¥å¼•å…¥ç»„ä»¶" aria-hidden="true" class="header-anchor">#</a> 4. å¼‚æ­¥å¼•å…¥ç»„ä»¶</h4> <ol><li>ä¸¤ç§è¯­æ³•å½¢å¼</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>   <span class="token comment">// ä¸¤ç§è¯­æ³•å½¢å¼ï¼š </span>
   <span class="token number">1</span> <span class="token function-variable function">component</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'/component_url/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token number">2</span> <span class="token function-variable function">component</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       <span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'/component_url/'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> resolve<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>é¡µé¢ä¸­è·¯ç”±é…ç½®</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>   <span class="token comment">// paceOs.vue</span>

   <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
       name<span class="token punctuation">:</span> <span class="token string">'PACEOS'</span><span class="token punctuation">,</span>
       metaInfo<span class="token punctuation">:</span> <span class="token punctuation">{</span>
           title<span class="token punctuation">:</span> <span class="token string">'PACEOS'</span><span class="token punctuation">,</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
       components<span class="token punctuation">:</span> <span class="token punctuation">{</span>
           <span class="token string">'mobile-header-container'</span><span class="token punctuation">:</span> MobileHeaderContainer<span class="token punctuation">,</span>
           <span class="token string">'vue-lazy-component'</span><span class="token punctuation">:</span> VueLazyComponent<span class="token punctuation">,</span>
           <span class="token string">'mobile-skeleton'</span><span class="token punctuation">:</span> MobileSkeleton<span class="token punctuation">,</span>
           <span class="token function-variable function">MobilePaceOsP1</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'components/mobile/paceos/PaceOs-p1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
           <span class="token function-variable function">MobilePaceOsP2</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'components/mobile/paceos/PaceOs-p2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
           <span class="token operator">...</span>
           <span class="token function-variable function">MobileFooterContainer</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'components/mobile/common/FooterContainer'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token operator">&lt;</span>
   <span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h4 id="_5-é¡µé¢ä¸­ä½¿ç”¨"><a href="#_5-é¡µé¢ä¸­ä½¿ç”¨" aria-hidden="true" class="header-anchor">#</a> 5. é¡µé¢ä¸­ä½¿ç”¨</h4> <ol><li>æ¨¡æ¿è¯­æ³•</li></ol> <div class="language-vue extra-class"><pre class="language-vue"><code>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vue-lazy-component</span>
     <span class="token attr-name">@init</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>init<span class="token punctuation">&quot;</span></span>
     <span class="token attr-name">@beforeInit</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>beforeInit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
     <span class="token comment">&lt;!-- çœŸå®ç»„ä»¶--&gt;</span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mobile-paceOs</span><span class="token punctuation">/&gt;</span></span>
     <span class="token comment">&lt;!-- éª¨æ¶ç»„ä»¶ï¼Œ åœ¨çœŸå®ç»„ä»¶æ¸²æŸ“å®Œæ¯•åæ¶ˆå¤± --&gt;</span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mobile-skeleton</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>skeleton<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>vue-lazy-component</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ol start="2"><li>é¡¹ç›®ä¸­ä½¿ç”¨</li></ol> <div class="language-vue extra-class"><pre class="language-vue"><code>   <span class="token comment">&lt;!-- paceOs.vue --&gt;</span>
   
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vue-lazy-component</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">slot-scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>scope<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mobile-paceOs-p13</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>scope.loading<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mobile-skeleton</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>skeleton<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>vue-lazy-component</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>é€šè¿‡ <code>vue-lazy-component</code> æ ‡ç­¾çš„åŒ…è£¹ï¼Œ å…ˆé¢„åŠ è½½ <code>mobile-skeleton</code> é¡µé¢é¢„ç•™ç©ºé—´ï¼Œ å¾…æ»‘åˆ°å½“å‰é¡µé¢æ—¶ï¼Œ æ˜¾ç¤ºå½“å‰å­ç»„ä»¶ã€‚</li> <li>é€šè¿‡Â  <code>slot-scope</code> Â ç‰¹æ€§ä»å­ç»„ä»¶è·å–æ•°æ®ï¼Œ <code>scope.loading=true</code> æ—¶ï¼Œ <code>&lt;mobile-paceOs-p13/&gt;</code> ç»„ä»¶æ¸²æŸ“æˆåŠŸã€‚</li></ul> <ol start="3"><li><p>ä½¿ç”¨è¿™ä¸ªæ‡’åŠ è½½ç»„ä»¶é‡åˆ°çš„é—®é¢˜</p> <ul><li>ç”¨æ‡’åŠ è½½ç»„ä»¶åŒ…è£¹çš„å­ç»„ä»¶ <code>&lt;mobile-paceOs-p3/&gt;</code> åœ¨é¡µé¢ä¸Šæ»‘å‡ºã€ è¿›å…¥æ—¶ï¼Œ åŠ¨ç”»æœªæ‰§è¡Œã€‚</li></ul></li></ol> <div class="language-vue extra-class"><pre class="language-vue"><code>     <span class="token comment">&lt;!--PaceOs.vue--&gt;</span>
     
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vue-lazy-component</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">slot-scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>scope<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
       	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mobile-paceOs-p3</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>scope.loading<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mobile-skeleton</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>skeleton<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>vue-lazy-component</span><span class="token punctuation">&gt;</span></span>
     ```

```vue
     <span class="token comment">&lt;!--PaceOs-p3.vue--&gt;</span>
     
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>paceOs-p3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
     		...
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>on-scroll-view</span> <span class="token attr-name">:config</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>onScrollViewConfig<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>p3-dial zIndex1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>img1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>//3gimg.qq.com/wspbbs/pace/official-site/images/paceos/s03_dial_l4.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
           ...
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>on-scroll-view</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
     ```

   - é€šè¿‡æ‰“å°ï¼Œ å‘ç°æ˜¯PaceOs-p3.vueæ–‡ä»¶é‡Œï¼Œ `on-scroll-view` åŒ…è£¹çš„å…ƒç´ è·å–çš„çˆ¶èŠ‚ç‚¹ä¸æ˜¯æœ€å¤–å±‚çˆ¶èŠ‚ç‚¹ï¼Œ æ‰€ä»¥åœ¨OnScrollView.vueä¿®æ”¹ï¼š 

```js
     // OnScrollView.vue

     // å½“å‰å…ƒç´ å¤´éƒ¨è·ç¦»æ•´ä¸ªé¡µé¢é¡¶éƒ¨çš„è·ç¦»
     // this.offsetTop = component.offsetTop + component.offsetParent.offsetTop; 
     this.offsetTop = component.offsetTop + this.getParentsNode().offsetTop;

     // è·å–å…ƒç´ åŒ…è£¹çš„çˆ¶èŠ‚ç‚¹
     getParentsNode() {
         let node = this.$el.offsetParent;
         if (this.targetClass !== '') {
             // å¦‚æœå½“å‰å…ƒç´ çš„çˆ¶èŠ‚ç‚¹çš„classä¸å­˜åœ¨â€˜lazyload', åˆ™ä¸€ç›´å‘ä¸Šæ‰¾
             while (node.getAttribute('class').indexOf(this.targetClass) === -1) {
                 node = node.offsetParent;
             }
         }
         return node;
     }
</code></pre></div><ul><li>åœ¨ <code>on-scroll-view</code> æ ‡ç­¾é‡Œæ·»åŠ  <code>targetClass=&quot;lazyLoad&quot;</code></li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code>     <span class="token comment">&lt;!--PaceOs-p3.vue--&gt;</span>
     
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>on-scroll-view</span> <span class="token attr-name">:config</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>onScrollViewConfig<span class="token punctuation">&quot;</span></span> <span class="token attr-name">targetClass</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>lazyLoad<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
           ...
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>on-scroll-view</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
     ```

   - åœ¨ `transition-group` æ ‡ç­¾æ·»åŠ  `class=&quot;lazyLoad&quot;` 

```vue
     <span class="token comment">&lt;!-- VueLazyComponent.vue --&gt;</span>
     
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition-group</span> <span class="token attr-name">:tag</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>tagName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>lazy-component<span class="token punctuation">&quot;</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span> </span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>lazyLoad<span class="token punctuation">&quot;</span></span><span class="token attr-name">...</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition-group</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
     ```

   - é€šè¿‡æ·»åŠ çš„ `getParentsNode()` æ–¹æ³•ï¼Œ èƒ½è§£å†³åŠ¨ç”»æœªæ‰§è¡Œçš„é—®é¢˜ã€‚ 

####å‚è€ƒé“¾æ¥

[vue-lazyload]: https://github.com/hilongjw/vue-lazyload#readme
[vue-lazy-component]: https://github.com/xunleif2e/vue-lazy-component

</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/pages/vue/vue-cli.html" class="prev">
          ğŸ“„vue-cli(ç®€ï¼‰
        </a></span> <span class="next"><a href="/pages/vue/patch.html">
          ğŸ“„é‡åˆ°çš„é—®é¢˜
        </a>
        â†’
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d3efc14e.js" defer></script><script src="/assets/js/2.3a3a5c3a.js" defer></script><script src="/assets/js/26.e8884916.js" defer></script>
  </body>
</html>
